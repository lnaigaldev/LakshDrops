<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <style>
    body { font-family: Arial; padding: 40px; }
    input { padding: 8px; width: 300px; }
    button { padding: 8px; cursor: pointer; }
    table { width: 100%; margin-top: 30px; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 10px; }
    th { background: #f5f5f5; }
    .danger { background: #e74c3c; color: white; border: none; }
    .hidden { display: none; }
  </style>
</head>
<body>

<h2>Admin Dashboard</h2>

<div id="login">
  <input id="adminKey" placeholder="Admin key">
  <button onclick="loadFiles()">Login</button>
</div>

<div id="dashboard" class="hidden">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Uploaded</th>
        <th>Download</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody id="files"></tbody>
  </table>
</div>

<script>
  let ADMIN_KEY = "";

  async function loadFiles() {
    ADMIN_KEY = document.getElementById("adminKey").value.trim();
    if (!ADMIN_KEY) return alert("Admin key required");

    const res = await fetch("/admin/files", {
      headers: { "x-admin-key": ADMIN_KEY }
    });

    if (!res.ok) return alert("Invalid admin key");

    const data = await res.json();
    document.getElementById("login").classList.add("hidden");
    document.getElementById("dashboard").classList.remove("hidden");

    const tbody = document.getElementById("files");
    tbody.innerHTML = "";

    for (const id in data) {
      const f = data[id];
      tbody.innerHTML += `
        <tr>
          <td>${id}</td>
          <td>${f.originalName}</td>
          <td>${new Date(f.uploadedAt).toLocaleString()}</td>
          <td><a href="/download/${id}?key=${f.downloadKey}" target="_blank">Download</a></td>
          <td><button class="danger" onclick="del('${id}')">Delete</button></td>
        </tr>`;
    }
  }

  async function del(id) {
    if (!confirm("Delete file permanently?")) return;

    await fetch("/admin/files/" + id, {
      method: "DELETE",
      headers: { "x-admin-key": ADMIN_KEY }
    });

    loadFiles();
  }
</script>

</body>
</html>
