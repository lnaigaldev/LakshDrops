<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>LakshDrops</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <h1>LakshDrops</h1>
  <p class="tagline">Drop files. Share keys. Stay secure.</p>

  <div id="dropZone">
    <p>Drag & Drop file here<br>or click to select</p>
    <input type="file" id="fileInput" hidden>
  </div>

  <input id="accessKey" placeholder="Set access key">
  <button onclick="upload()">Upload</button>

  <h2>Available Files</h2>
  <ul id="fileList"></ul>
</div>

<script>
const dropZone = document.getElementById("dropZone");
const fileInput = document.getElementById("fileInput");
let selectedFile = null;

dropZone.onclick = () => fileInput.click();

fileInput.onchange = e => selectedFile = e.target.files[0];

dropZone.ondragover = e => {
  e.preventDefault();
  dropZone.classList.add("hover");
};

dropZone.ondragleave = () => dropZone.classList.remove("hover");

dropZone.ondrop = e => {
  e.preventDefault();
  selectedFile = e.dataTransfer.files[0];
  dropZone.classList.remove("hover");
  dropZone.querySelector("p").innerText = selectedFile.name;
};

async function upload() {
  if (!selectedFile || !accessKey.value) return alert("File & key required");

  const fd = new FormData();
  fd.append("file", selectedFile);
  fd.append("accessKey", accessKey.value);

  const res = await fetch("/upload", { method: "POST", body: fd });
  if (!res.ok) return alert("Upload failed");
  
  accessKey.value = "";
  selectedFile = null;
  dropZone.querySelector("p").innerHTML = "Drag & Drop file here<br>or click to select";
  loadFiles();
}

async function loadFiles() {
  const res = await fetch("/files");
  const files = await res.json();
  fileList.innerHTML = "";
  files.forEach(f => {
    const li = document.createElement("li");
    li.innerHTML = `${f.name} <button onclick="unlock('${f.id}', '${f.name}')">Unlock</button>`;
    fileList.appendChild(li);
  });
}

async function unlock(id, filename) {
  const key = prompt("Enter access key:");
  if (!key) return;

  const res = await fetch("/download/" + id, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ key })
  });

  if (!res.ok) return alert("Wrong key");

  const blob = await res.blob();
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
}

loadFiles();
</script>

</body>
</html>
